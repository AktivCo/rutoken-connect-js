const Status=Object.freeze({noExtension:-1,ready:0,noNative:1,oldExtension:2,oldNative:3,error:4}),lastStatus=Status.error,isFirefox="undefined"!=typeof InstallTrigger;let status,statusPromise;function getStatus(){if(void 0!==status&&null!==status)return Promise.resolve(status);if(void 0!==statusPromise)return statusPromise;let a,b;statusPromise=new Promise((c,d)=>{a=a=>{void 0!==statusPromise&&null!==status&&c(a),status=a,statusPromise=void 0},b=a=>{void 0!==statusPromise&&null!==status&&d(a),status=null,statusPromise=Promise.reject(a)}});const c=c=>{if(c.source===window&&void 0!==c.data&&void 0!==c.data.rutoken&&"EE4F9C58-64D8-4FCD-AB45-0E3040EEB37D"===c.data.rutoken.uuid){const{status:d}=c.data.rutoken;void 0!==d&&0<=d&&d<=lastStatus?a(d):b(new Error(`Couldn't parse extension status: ${d}`))}};window.addEventListener("message",c);let d="chrome-extension://acbchkahfmndkenefkcklofjmipghjjp/check_rtconnect_extension";const e={};return isFirefox&&(d="https://qbwjg564lyt1tdfo23xz5l3udvdfe0ux.rutoken.ru/api/v1/check_rtconnect_extension",e.mode="no-cors"),fetch(d,e).then(()=>{isFirefox&&a(Status.noExtension)}).catch(d=>{isFirefox?setTimeout(()=>{void 0===status&&(window.removeEventListener("message",c),b(d))},2e3):a(Status.noExtension)}).then(()=>void 0!==status&&null!==status?status:statusPromise)}export{Status,getStatus};